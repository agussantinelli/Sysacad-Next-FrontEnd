<app-page-layout title="Gestión de Carreras" icon="school">
    <div class="content-container">

        <div class="stats-overview">
            <div class="stat-box" *ngFor="let carrera of carreras">
                <h4>{{ carrera.alias }}</h4>
                <p class="count">{{ carrera.cantidadMatriculados }}</p>
                <span class="label">Matriculados</span>
            </div>
        </div>

        <div class="card list-card">
            @if (isLoading) {
            <app-loading-spinner></app-loading-spinner>
            } @else {

            <div class="table-actions">
                <button class="btn-primary" (click)="openCreateModal()">
                    <span class="material-icons">add</span> Nueva Carrera
                </button>
            </div>

            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Alias</th>
                            <th>Matriculados</th>
                            <th>Planes</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (carrera of carreras; track carrera.id) {
                        <tr>
                            <td>{{ carrera.nombre }}</td>
                            <td>{{ carrera.alias }}</td>
                            <td>{{ carrera.cantidadMatriculados }}</td>
                            <td>
                                @if (carrera.planes && carrera.planes.length > 0) {
                                <button class="btn-outline" (click)="viewPlans(carrera)">Ver Planes</button>
                                } @else {
                                <span class="no-plan-label">Sin Plan</span>
                                }
                            </td>
                        </tr>
                        } @empty {
                        <tr>
                            <td colspan="4" class="empty-cell">No hay carreras registradas.</td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
            }
        </div>
    </div>

    
    @if (showModal) {
    <div class="modal-overlay" (click)="closeModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <h4>Nueva Carrera</h4>
            <div class="form-group">
                <label>Nombre</label>
                <input type="text" [(ngModel)]="newCarrera.nombre" class="form-control"
                    placeholder="Ej: Ingeniería en Sistemas de Información">
            </div>
            <div class="form-group">
                <label>Alias</label>
                <input type="text" [(ngModel)]="newCarrera.alias" class="form-control" placeholder="Ej: ISI">
            </div>
            <div class="form-group">
                <label>Horas Electivas Requeridas</label>
                <input type="number" [(ngModel)]="newCarrera.horasElectivasRequeridas" class="form-control"
                    placeholder="Ej: 120" min="0">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" (click)="closeModal()">Cancelar</button>
                <button class="btn-primary" (click)="createCarrera()"
                    [disabled]="!newCarrera.nombre || !newCarrera.alias || isLoading">
                    Crear
                </button>
            </div>
        </div>
    </div>
    }

    
    @if (showPlansModal) {
    <div class="modal-overlay" (click)="closePlansModal()">
        <div class="modal-content large-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h4>Planes de Estudio - {{ selectedCarreraName }}</h4>
                <button class="close-btn" (click)="closePlansModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>

            <div class="plans-list">
                @if (selectedCarreraPlans.length === 0) {
                <p class="empty-state">No hay planes registrados para esta carrera.</p>
                } @else {
                <div class="plan-item" *ngFor="let plan of selectedCarreraPlans">
                    <div class="plan-info">
                        <span class="plan-year">Plan {{ plan.anio }}</span>
                        <span class="plan-status" [class.vigente]="plan.esVigente" [class.no-vigente]="!plan.esVigente">
                            {{ plan.esVigente ? 'Vigente' : 'No Vigente' }}
                        </span>
                        <span class="plan-name">{{ plan.nombre }}</span>
                    </div>
                    <button class="btn-outline btn-sm" (click)="goToPlanDetail(plan)">
                        Ver Detalle
                    </button>
                </div>
                }
            </div>

            <div class="modal-actions">
                <button class="btn-secondary" (click)="closePlansModal()">Cerrar</button>
            </div>
        </div>
    </div>
    }

</app-page-layout>