<app-page-layout [title]="'Calificar: ' + materiaNombre" [backRoute]="['/professor/exams', idMesa]">


    <app-loading-spinner *ngIf="isLoading" message="Cargando alumnos..."></app-loading-spinner>

    <app-alert-message *ngIf="error" type="error" [message]="error" (close)="error = null"></app-alert-message>
    <app-alert-message *ngIf="successMessage" type="success" [message]="successMessage"
        (close)="successMessage = null"></app-alert-message>

    <div class="grading-container" *ngIf="!isLoading && inscriptos.length > 0">

        <div class="table-responsive">
            <table class="utn-table">
                <thead>
                    <tr>
                        <th>Legajo</th>
                        <th>Alumno</th>
                        <th>Estado</th>
                        <th>Nota</th>
                        <th>Tomo</th>
                        <th>Folio</th>
                    </tr>
                </thead>
                <tbody>
                    @for (alumno of inscriptos; track alumno.idInscripcion) {
                    <tr [class.aprobado]="alumno.estado === 'APROBADO'"
                        [class.desaprobado]="alumno.estado === 'DESAPROBADO'">
                        <td class="font-medium">{{ alumno.legajo }}</td>
                        <td>{{ alumno.apellido }}, {{ alumno.nombre }}</td>
                        <td>
                            <select class="form-select status-select" [(ngModel)]="alumno.estado">
                                <option value="PENDIENTE" disabled>Pendiente</option>
                                <option value="APROBADO">Aprobado</option>
                                <option value="DESAPROBADO">Desaprobado</option>
                                <option value="AUSENTE">Ausente</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" class="form-input grade-input" [(ngModel)]="alumno.nota" min="1"
                                max="10" [disabled]="alumno.estado === 'AUSENTE'" placeholder="-">
                        </td>
                        <td>
                            <input type="text" class="form-input folio-input" placeholder="T" [(ngModel)]="alumno.tomo"
                                [disabled]="alumno.estado !== 'APROBADO'">
                        </td>
                        <td>
                            <input type="text" class="form-input folio-input" placeholder="F" [(ngModel)]="alumno.folio"
                                [disabled]="alumno.estado !== 'APROBADO'">
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="form-actions" *ngIf="!isReadOnly">
            <button class="btn-save" (click)="saveGrades()" [disabled]="isSaving || isReadOnly">
                <span class="material-icons" *ngIf="!isSaving">save</span>
                <span *ngIf="isSaving">Guardando...</span>
                <span *ngIf="!isSaving">Guardar Notas</span>
            </button>
        </div>

    </div>

    <div class="empty-state" *ngIf="!isLoading && inscriptos.length === 0 && !error">
        <span class="material-icons">people_outline</span>
        <h3>No hay alumnos inscriptos en esta mesa.</h3>
    </div>

</app-page-layout>