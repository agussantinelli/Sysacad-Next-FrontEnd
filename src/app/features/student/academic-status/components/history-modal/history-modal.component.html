<div class="modal-overlay" (click)="onClose()">
    <div class="modal-content" (click)="$event.stopPropagation()">

        <!-- Header -->
        <div class="modal-header">
            <h2 class="modal-title">
                Historial: <span>{{ materia?.nombre }}</span>
            </h2>
            <button (click)="onClose()" class="btn-close-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <!-- Body -->
        <div class="modal-body relative">

            <!-- Loading Overlay -->
            <div *ngIf="isLoading"
                class="absolute inset-0 z-10 flex items-center justify-center bg-gray-900 bg-opacity-80 backdrop-blur-sm">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
            </div>

            <!-- Exam History -->
            <div class="section-container">
                <h3 class="section-title exams">Ex치menes Finales</h3>

                <div *ngIf="materia?.historyExams?.length > 0; else noExams" class="table-container">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Turno</th>
                                <th>Estado</th>
                                <th>Nota</th>
                                <th>Tomo</th>
                                <th>Folio</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let exam of materia.historyExams">
                                <td>{{ exam.fechaExamen | date:'dd/MM/yyyy' }}</td>
                                <td>{{ exam.turno }}</td>
                                <td>
                                    <span class="status-badge" [ngClass]="{
                                        'status-approved': exam.estado === 'APROBADO',
                                        'status-failed': exam.estado === 'REPROBADO',
                                        'status-pending': exam.estado === 'PENDIENTE'
                                    }">{{ exam.estado }}</span>
                                </td>
                                <td class="font-bold">{{ exam.nota }}</td>
                                <td class="text-xs text-gray-400 font-mono">{{ exam.tomo || '-' }}</td>
                                <td class="text-xs text-gray-400 font-mono">{{ exam.folio || '-' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <ng-template #noExams>
                    <p class="text-empty">No hay registros de ex치menes finales.</p>
                </ng-template>
            </div>

            <!-- Coursework History -->
            <div class="section-container">
                <h3 class="section-title coursework">Cursadas</h3>

                <div *ngIf="materia?.historyCursadas?.length > 0; else noCursadas" class="table-container">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Fecha Inscripci칩n</th>
                                <th>Comisi칩n</th>
                                <th>Estado</th>
                                <th>Nota</th>
                                <th>Tomo</th>
                                <th>Folio</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let cursada of materia.historyCursadas">
                                <td>{{ cursada.fechaInscripcion | date:'dd/MM/yyyy' }}</td>
                                <td>{{ cursada.comision }}</td>
                                <td class="font-bold">{{ cursada.estado }}</td>
                                <td>{{ cursada.nota }}</td>
                                <td class="text-xs text-gray-400 font-mono">{{ cursada.tomo || '-' }}</td>
                                <td class="text-xs text-gray-400 font-mono">{{ cursada.folio || '-' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <ng-template #noCursadas>
                    <p class="text-empty">No hay registros de cursadas.</p>
                </ng-template>
            </div>

        </div>

        <!-- Footer -->
        <div class="modal-footer">
            <button (click)="onClose()" class="btn-close">
                Cerrar
            </button>
        </div>
    </div>
</div>