<div class="modal-overlay" (click)="onClose()">
    <div class="modal-container" (click)="$event.stopPropagation()">

        <div class="modal-header">
            <h2 class="modal-title">Inscribirse a: <span class="highlight-text">{{ title }}</span></h2>
            <button (click)="onClose()" class="btn-close-icon">
                <span class="material-icons">close</span>
            </button>
        </div>

        <div class="modal-body">
            <!-- Mode 1: Exam Inscription (Detail View) -->
            @if (examDetail) {
            <div class="exam-detail-card">
                <p class="section-subtitle">Detalles de la mesa de examen:</p>

                <div class="detail-row">
                    <span class="label"><span class="material-icons icon-sm">event</span> Fecha:</span>
                    <span class="value">{{ examDetail.diaExamen }}</span>
                </div>
                <div class="detail-row">
                    <span class="label"><span class="material-icons icon-sm">schedule</span> Hora:</span>
                    <span class="value">{{ examDetail.horaExamen }}</span>
                </div>
                <div class="detail-row">
                    <span class="label"><span class="material-icons icon-sm">person</span> Presidente:</span>
                    <span class="value">{{ examDetail.nombrePresidente }}</span>
                </div>

                <div class="alert-info mt-4">
                    <span class="material-icons info-icon">info</span>
                    <span>Se validaron tus condiciones académicas.</span>
                </div>
            </div>
            }
            <!-- Mode 2: Commission Selection (List View) -->
            @else {
            <p class="section-subtitle">Selecciona una comisión:</p>

            <div class="commission-list">
                @for (comision of commissions; track comision.idComision) {
                <div class="commission-card" [class.selected]="selectedCommission?.idComision === comision.idComision"
                    (click)="onSelectCommission(comision)">

                    <div class="commission-content">
                        <div class="commission-info">
                            <h4 class="commission-name">{{ comision.nombreComision }}</h4>

                            <!-- Line 1: Professors -->
                            <div class="commission-detail-row">
                                <span class="material-icons icon-sm">person</span>
                                <span class="detail-text" title="{{ comision.profesores.join(', ') }}">
                                    {{ comision.profesores.length > 0 ? comision.profesores.join(', ') : 'Sin profesor
                                    asignado' }}
                                </span>
                            </div>

                            <!-- Line 2: Turno -->
                            <div class="commission-detail-row">
                                <span class="material-icons icon-sm">brightness_6</span>
                                <span class="detail-text">{{ comision.turno }}</span>
                            </div>

                            <!-- Line 3: Schedule and Location -->
                            <div class="commission-detail-row">
                                <span class="detail-group">
                                    <span class="material-icons icon-sm">schedule</span>
                                    <div class="schedule-column">
                                        @for (horario of comision.horarios; track horario) {
                                        <span class="schedule-text">{{ horario }}</span>
                                        }
                                    </div>
                                </span>
                                <span class="detail-group">
                                    <span class="material-icons icon-sm">place</span>
                                    <span class="detail-text">{{ comision.ubicacion || '---' }}</span>
                                </span>
                            </div>
                        </div>

                        <div class="selection-indicator">
                            @if (selectedCommission?.idComision === comision.idComision) {
                            <div class="radio-checked">
                                <span class="material-icons check-icon">check</span>
                            </div>
                            } @else {
                            <div class="radio-unchecked"></div>
                            }
                        </div>
                    </div>
                </div>
                } @empty {
                <div class="empty-state">
                    No hay comisiones disponibles.
                </div>
                }
            </div>
            }
        </div>

        <div class="modal-footer">
            <button class="btn-cancel" (click)="onClose()">Cancelar</button>
            <button class="btn-confirm" [disabled]="!examDetail && !selectedCommission" (click)="confirm()">
                Confirmar Inscripción
            </button>
        </div>
    </div>
</div>