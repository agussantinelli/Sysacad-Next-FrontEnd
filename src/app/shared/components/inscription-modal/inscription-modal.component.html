<div class="modal-overlay" (click)="onClose()">
    <div class="modal-container" (click)="$event.stopPropagation()">

        <div class="modal-header">
            <h2 class="modal-title">Inscribirse a: <span class="highlight-text">{{ title }}</span></h2>
            <button (click)="onClose()" class="btn-close-icon">
                <span class="material-icons">close</span>
            </button>
        </div>

        <div class="modal-body">
            <!-- Mode 1: Exam Inscription (Detail View) -->
            @if (examDetail) {
            <div class="exam-detail-card">
                <p class="section-subtitle">Detalles de la mesa de examen:</p>

                <div class="detail-row">
                    <span class="label"><span class="material-icons icon-sm">event</span> Fecha:</span>
                    <span class="value">{{ examDetail.diaExamen }}</span>
                </div>
                <div class="detail-row">
                    <span class="label"><span class="material-icons icon-sm">schedule</span> Hora:</span>
                    <span class="value">{{ examDetail.horaExamen }}</span>
                </div>
                <div class="detail-row">
                    <span class="label"><span class="material-icons icon-sm">person</span> Presidente:</span>
                    <span class="value">{{ examDetail.nombrePresidente }}</span>
                </div>

                <div class="alert-info mt-4">
                    <span class="material-icons info-icon">info</span>
                    <span>Se validaron tus condiciones académicas.</span>
                </div>
            </div>
            }
            @else if (examTables.length > 0) {
            <p class="section-subtitle">Selecciona una mesa de examen:</p>

            <div class="commission-list">
                @for (table of examTables; track table.idDetalleMesa) {
                <div class="commission-card" [class.selected]="selectedExamTable?.idDetalleMesa === table.idDetalleMesa"
                    [class.disabled-card]="!table.habilitada"
                    (click)="table.habilitada ? onSelectExamTable(table) : null">

                    <div class="commission-content">
                        <div class="commission-info">
                            <h4 class="commission-name">
                                {{ table.nombreMesa }}
                                @if (!table.habilitada) {
                                <span class="badge-error">No disponible</span>
                                }
                            </h4>

                            <!-- Error Message -->
                            @if (!table.habilitada) {
                            <div class="overlap-warning">
                                <span class="material-icons warning-icon">warning_amber</span>
                                <span>{{ table.mensaje }}</span>
                            </div>
                            }

                            <!-- Line 1: Date & Time -->
                            <div class="commission-detail-row">
                                <span class="detail-group">
                                    <span class="material-icons icon-sm">event</span>
                                    <span class="detail-text">{{ table.fecha }}</span>
                                </span>
                                <span class="detail-group">
                                    <span class="material-icons icon-sm">schedule</span>
                                    <span class="detail-text">{{ table.hora }}</span>
                                </span>
                            </div>

                            <!-- Line 2: President -->
                            <div class="commission-detail-row">
                                <span class="material-icons icon-sm">person</span>
                                <span class="detail-text" title="{{ table.presidente }}">
                                    {{ table.presidente || 'A designar' }}
                                </span>
                            </div>
                        </div>

                        <div class="selection-indicator">
                            @if (selectedExamTable?.idDetalleMesa === table.idDetalleMesa) {
                            <div class="radio-checked">
                                <span class="material-icons check-icon">check</span>
                            </div>
                            } @else if (table.habilitada) {
                            <div class="radio-unchecked"></div>
                            } @else {
                            <div class="radio-disabled"></div>
                            }
                        </div>
                    </div>
                </div>
                }
            </div>
            }
            <!-- Mode 2: Commission Selection (List View) -->
            @else {
            <p class="section-subtitle">Selecciona una comisión:</p>

            <div class="commission-list">
                @for (comision of commissions; track comision.idComision) {
                <div class="commission-card" [class.selected]="selectedCommission?.idComision === comision.idComision"
                    [class.disabled-card]="!comision.habilitada"
                    (click)="comision.habilitada ? onSelectCommission(comision) : null">

                    <div class="commission-content">
                        <div class="commission-info">
                            <h4 class="commission-name">
                                {{ comision.nombreComision }}
                                @if (!comision.habilitada) {
                                <span class="badge-error">No disponible</span>
                                }
                            </h4>

                            @if (!comision.habilitada) {
                            <div class="overlap-warning">
                                <span class="material-icons warning-icon">warning_amber</span>
                                <span>{{ comision.mensaje }}</span>
                            </div>
                            }

                            <div class="commission-detail-row">
                                <span class="material-icons icon-sm">person</span>
                                <span class="detail-text" title="{{ comision.profesores.join(', ') }}">
                                    {{ comision.profesores.length > 0 ? comision.profesores.join(', ') : 'Sin profesor
                                    asignado' }}
                                </span>
                            </div>

                            <div class="commission-detail-row">
                                <span class="material-icons icon-sm">brightness_6</span>
                                <span class="detail-text">{{ comision.turno }}</span>
                            </div>

                            <!-- Line 3: Schedule and Location -->
                            <div class="commission-detail-row">
                                <span class="detail-group">
                                    <span class="material-icons icon-sm">schedule</span>
                                    <div class="schedule-column">
                                        @for (horario of comision.horarios; track horario) {
                                        <span class="schedule-text">{{ horario }}</span>
                                        }
                                    </div>
                                </span>
                                <span class="detail-group">
                                    <span class="material-icons icon-sm">place</span>
                                    <span class="detail-text">{{ comision.ubicacion || '---' }}</span>
                                </span>
                            </div>
                        </div>

                        <div class="selection-indicator">
                            @if (selectedCommission?.idComision === comision.idComision) {
                            <div class="radio-checked">
                                <span class="material-icons check-icon">check</span>
                            </div>
                            } @else if (comision.habilitada) {
                            <div class="radio-unchecked"></div>
                            } @else {
                            <div class="radio-disabled"></div>
                            }
                        </div>
                    </div>
                </div>
                } @empty {
                <div class="empty-state">
                    No hay comisiones disponibles.
                </div>
                }
            </div>
            }
        </div>

        <div class="modal-footer">
            <button class="btn-cancel" (click)="onClose()">Cancelar</button>
            <button class="btn-confirm" [disabled]="!examDetail && !selectedCommission && !selectedExamTable"
                (click)="confirm()">
                Confirmar Inscripción
            </button>
        </div>
    </div>
</div>