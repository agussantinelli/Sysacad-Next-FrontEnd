<div class="modal-overlay" (click)="close()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title">Subir Foto de Perfil</h3>
            <button class="close-btn" (click)="close()">
                <span class="material-icons">close</span>
            </button>
        </div>

        @if (!imageSource) {
        <div class="drop-zone" [class.dragover]="isDragging" (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" (click)="fileInput.click()">
            <span class="material-icons upload-icon">cloud_upload</span>
            <p class="drop-text">Arrastra tu imagen aqu√≠ o haz click para seleccionar</p>
            <button class="select-btn">Seleccionar Archivo</button>
            <input #fileInput type="file" hidden accept="image/*" (change)="onFileSelected($event)">
        </div>
        } @else {
        <div class="crop-area">
            @if (isUploading || isProcessing) {
            <app-loading-spinner
                [message]="isUploading ? 'Subiendo foto...' : 'Procesando imagen...'"></app-loading-spinner>
            }

            <div class="crop-container">
                <canvas #canvas></canvas>
            </div>

            <div class="modal-actions">
                <button class="btn-cancel" (click)="reset()" [disabled]="isUploading || isProcessing">Volver</button>
                <button class="btn-confirm" (click)="cropAndSave()" [disabled]="isProcessing || isUploading">
                    Guardar Foto
                </button>
            </div>
        </div>
        }
    </div>
</div>